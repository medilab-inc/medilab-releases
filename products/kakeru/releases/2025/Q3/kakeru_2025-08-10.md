# Kakeru アップデートのお知らせ

いつもKakeruをご利用いただきありがとうございます。
2025年8月10日にリリースした最新版の内容をお知らせいたします。

## 📢 今回のアップデートについて
今回のアップデートで、患者管理システムが全面的に刷新され、アクション管理機能が大幅に強化されました。また、在宅介入の自動判定や調整支援機能が追加され、業務効率が向上します。

## 🆕 新しく追加された機能

### 患者アクション管理の統合と状態管理
患者様ごとの対応事項を一元管理できる新しいシステムを導入しました。チェックポイントとアクションが統合され、より使いやすくなりました。

**お手元での確認方法：**
1. 患者詳細画面を開きます
2. 「アクション」セクションで全ての対応事項を確認できます
3. ステータス（保留中/計画済み/実施中/完了/却下）で管理できます
4. グループ（調整支援/在宅介入/その他）で分類表示されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#358, yakureki-front#303
- 主な変更:
  - PatientCheckpointとPatientActionを統合し新しいActionモデルに一本化
  - ViewSetベースの統一API設計
  - UUIDベースのモデル設計
  - ステータス管理の標準化（pending/planned/in_progress/declined/done）
- パフォーマンス: ページネーション実装（デフォルト20件）

</details>

### 在宅介入の自動判定機能
SOAP生成後に自動で在宅介入の必要性を判定し、該当する患者様にアクションを提案する機能を追加しました。

**お手元での確認方法：**
1. SOAP記録を生成します
2. システムが自動的に患者情報を分析します
3. 在宅介入が必要と判定された場合、アクション提案が表示されます
4. 提案されたアクションを確認し、必要に応じて登録できます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#358, #360
- 判定条件:
  - 複数医療機関の受診歴
  - 患者年齢
  - 処方薬剤数
  - その他の複合条件
- 設定: UserSettingsでuse_home_care_recommendationフラグ制御
- 処理: SOAP生成後の非同期バックグラウンド処理

</details>

### 調整支援候補の自動抽出
特定の条件を満たす患者様を自動的に抽出し、調整支援のアクションを提案する機能を追加しました。

**お手元での確認方法：**
1. 「管理ポータルへ」ボタンをクリックします
2. 「患者管理」カードをクリックします
3. 調整支援候補抽出を選択します
4. 条件（年齢、薬剤数など）を設定します
5. 「抽出実行」ボタンをクリックします
6. 該当患者にアクションが自動生成されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#350, #377, #379
- 管理コマンド: extract_adjustment_support_patients
- 抽出条件:
  - 複数医療機関受診
  - 年齢基準
  - 薬剤数
  - 添付文書内容でのフィルタリング
- RequestEventとの紐付け機能

</details>

### 薬品プレースホルダーの認識パターン拡張
SOAP記録で認識できる薬品プレースホルダーのパターンが増えました。

**お手元での確認方法：**
1. SOAP編集画面で【舌下錠】【胃腸薬】【解熱鎮痛薬】などを入力します
2. これらのテキストがクリック可能になります
3. クリックすると薬品選択ダイアログが表示されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#309
- 追加パターン:
  - 【xxx錠】（xxxは2文字以上）
  - 【xxx薬】（xxxは2文字以上）
- リファクタリング:
  - 正規表現パターンをconstants/medicationPatterns.tsに集約
  - createMedicationRegex関数で生成ロジック一元化

</details>

### ノイズキャンセリング機能の正式リリース
音声録音時のノイズキャンセリング機能がベータ版から正式版になりました。

**お手元での確認方法：**
1. 音声録音設定を開きます
2. ノイズキャンセリング機能が「β版」表記なしで表示されます
3. より安定した雑音除去が可能になりました

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#312
- 変更内容:
  - β版表記の削除
  - 機能の安定性向上

</details>

## 📈 使いやすさの改善

### アクション管理UIの全面改善
- **改善前：** チェックポイントとアクションが別々で管理しづらい
- **改善後：** 統一されたアクション管理画面で一元管理

**お手元での確認方法：**
1. 患者詳細画面の「アクション」セクションを開きます
2. アクションカードが2行レイアウトで見やすく表示されます
3. グループタブで調整支援/在宅介入/その他を切り替えられます
4. フィルター機能で必要な情報だけを表示できます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#303
- 新規コンポーネント:
  - PatientActionProposal: アクション提案管理
  - ActionCard: 統一アクションカード表示
  - ActionGroupTabs: グループタブ切り替え
  - FlexibleActionFilters: 柔軟なフィルタリング
- レスポンシブ対応と横スクロール問題の解決

</details>

### 機能のオン/オフ設定
各施設のニーズに合わせて、在宅介入判定やチェックポイント機能を個別に有効/無効にできるようになりました。

**お手元での確認方法：**
1. 「管理ポータルへ」ボタンをクリックします
2. 「SOAP設定」カードをクリックします
2. 「在宅介入判定を使用」のチェックでオン/オフを切り替えます
3. 「チェックポイント機能を使用」のチェックでオン/オフを切り替えます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#360
- UserSettingsフィールド:
  - use_home_care_recommendation: 在宅介入判定（デフォルト: False）
  - use_checkpoint_service: チェックポイント機能（デフォルト: False）
- 各機能の独立制御が可能

</details>

## ✅ 不具合の修正

### SOAP設定の薬歴表示日数の初回表示不一致を修正
- **修正内容：** 設定画面を開いた際の薬歴表示日数が実際の設定と異なる問題を修正
- **影響範囲：** SOAP設定画面

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-front#307
- 原因: 初期値の読み込み処理の不具合
- 対策: 設定値の正しい反映処理

</details>

### RequestEventのアクセスエラーを修正
- **修正内容：** 特定の条件下でRequestEventのuserフィールドにアクセスできない問題を修正
- **影響範囲：** 調整支援機能

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-back#362
- 原因: userフィールドの参照エラー
- 対策: 適切なエラーハンドリング追加

</details>

### アクショングループラベルの誤字を修正
- **修正内容：** 「調剤支援」を「調整支援」に統一
- **影響範囲：** アクション管理画面の表示

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-front#305, yakureki-back#367
- 変更内容: 全体的な表記統一

</details>

## ⚡ 処理速度の向上

### AI処理の最適化
- LLMモデルの使い分けによる処理速度向上
- エラー発生時のリトライ処理改善

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- **モデル最適化**（yakureki-back#382, #384, #386）
  - クイックモード: Gemini Pro使用
  - 通常モード: Gemini Pro Complex使用
  - モデル選択の自動最適化
- **エラー対策**（yakureki-back#388, #401）
  - MAX_TOKENSエラーの改善
  - JSONDecodeErrorの対処
  - 繰り返し生成問題の改善
- **パラメータ調整**（yakureki-back#403）
  - temperature設定の最適化

</details>

### 音声文字起こしの構造化対応
- 音声文字起こし結果を構造化データとして取得可能に
- より正確な情報抽出が可能

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#398
- 機能追加:
  - response_schemaサポート
  - 構造化データ取得

</details>

## 🏗️ システム基盤の更新

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

このセクションは技術者向けの情報です。

### インフラ改善
- MinIOセットアップとマイグレーションの問題修正（#373）
- Gemini 2.0モデルのthinking budget設定エラー修正（#396）

### コード品質向上
- CodeRabbitの自動レビュー機能削除（#352）
- LLMインターフェースとセッティングの更新（#356）
- ハイリスク薬剤の変数名統一（#370）

### データベース最適化
- チェックポイントグループ化判定の実装と改善（#371, #372）
- 調剤支援存在チェックポイントの実装（#379）

</details>

## 🔄 アップデート方法

システムは自動的に更新されます。特別な操作は必要ありません。

## ⚠️ ご注意事項

- 在宅介入判定機能とチェックポイント機能は初期設定では無効になっています
- 必要に応じて管理画面から有効化してください
- 一部の高度な機能は管理者権限が必要です

## 💡 便利な使い方のヒント

- アクション管理画面でグループタブを活用すると、種類別に効率的に確認できます
- 在宅介入判定を有効にすると、SOAP生成時に自動的に対象患者を抽出します
- 薬品プレースホルダーは【】で囲むだけで自動認識されます

## 📞 お問い合わせ

ご不明な点やお困りの際は、以下までお気軽にお問い合わせください：

- **電話：** [サポート電話番号]
- **メール：** support@medilab.jp
- **営業時間：** 平日 9:00-18:00

---

今後ともKakeruをよろしくお願いいたします。