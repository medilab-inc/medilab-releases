# Kakeru アップデートのお知らせ

いつもKakeruをご利用いただきありがとうございます。
2025年7月13日にリリースした最新版の内容をお知らせいたします。

## 📑 目次

---

- [📢 今回のアップデートについて](#-今回のアップデートについて)
- [🆕 新しく追加された機能](#-新しく追加された機能)
  - [服薬指導フレーズ自動提案機能](#服薬指導フレーズ自動提案機能)
  - [チャットによるSOAP改善提案機能](#チャットによるsoap改善提案機能)
  - [SOAP選択状態の自動保存機能](#soap選択状態の自動保存機能)
- [📈 使いやすさの改善](#-使いやすさの改善)
  - [モバイル対応の大幅強化](#モバイル対応の大幅強化)
  - [処方情報表示の視覚的改善](#処方情報表示の視覚的改善)
  - [ドロワーメニューのデザイン刷新](#ドロワーメニューのデザイン刷新)
- [✅ 不具合の修正](#-不具合の修正)
- [⚡ 処理速度の向上](#-処理速度の向上)
- [🏗️ システム基盤の更新](#️-システム基盤の更新)
- [🔄 アップデート方法](#-アップデート方法)
- [💡 便利な使い方のヒント](#-便利な使い方のヒント)
- [📞 お問い合わせ](#-お問い合わせ)

## 📢 今回のアップデートについて

---
今回のアップデートで、服薬指導支援機能が本格的にご利用いただけるようになり、診療記録の作成がよりスムーズになりました。

## 🆕 新しく追加された機能

---

### 服薬指導フレーズ自動提案機能
服薬指導時に役立つ情報や定型文が自動的に提案される機能を追加しました。患者様への説明がより効率的に行えるようになります。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者様を選択して詳細画面を開きます
3. 画面上部の「服薬指導支援」ボタンをクリックします
4. 「指導フレーズ」タブと「詳細情報」タブから必要な情報を選択できます
5. フレーズはドラッグ＆ドロップで順番を変更可能です

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#236, yakureki-back#297
- 主な変更:
  - 服薬指導支援API統合
  - フレーズ選択と保存機能の実装
  - ドラッグ＆ドロップによる順序変更
  - ポーリング機能（AI生成中は2秒間隔でリトライ）
- パフォーマンス: データ取得の非同期処理により画面表示の高速化

</details>

### チャットによるSOAP改善提案機能
SOAP記録に対して、AIが改善提案を行う機能を追加しました。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者様を選択します
3. 画面下部に表示される提案カードから選択します
4. クリックするとSOAPに自動的に反映されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#234, yakureki-back#295, #299
- 主な変更:
  - チャットサジェスチョンAPIの統合
  - 推奨項目の視覚的強調（青枠・青文字）
  - Google Gen AI SDKへの完全移行（#291）
- Gemini LLMモデルの最適化（#296）

</details>

### SOAP選択状態の自動保存機能
SOAP項目の選択状態が自動的に保存され、次回アクセス時にも維持されるようになりました。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者様を選択し、SOAP記録画面を開きます
3. 任意の項目を選択します
4. コピーやQRコード表示を行います
5. ページを更新しても選択状態が保持されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#231, yakureki-back#287
- 主な変更:
  - `is_selected`フィールドの追加
  - サーバー永続化機能の実装
  - 選択状態の自動同期

</details>

## 📈 使いやすさの改善

---

### モバイル対応の大幅強化
スマートフォンやタブレットでの使いやすさが大幅に向上しました。

- **改善前：** 録音ボタンが見切れる、フォローアップ提案が読みにくい
- **改善後：** 画面サイズに応じて最適なレイアウトに自動調整

**お手元での確認方法：**
1. スマートフォンまたはタブレットでKakeruにログインします
2. 「患者メニュー」ボタンをクリックします
3. 録音ボタンが患者名の下に配置されます
4. フォローアップ提案カードをスクロールで確認できます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#254, #256, #258
- 改善内容:
  - レスポンシブレイアウトの実装
  - フォローアップカードのスクロール機能
  - ヘッダー高さの動的調整（56px→80px）
  - Toast通知位置の統一化

</details>

### 処方情報表示の視覚的改善
処方薬の表示がより見やすく、分かりやすくなりました。

- **改善前：** 処方薬が一覧で表示され、グループが分かりにくい
- **改善後：** Rp.番号ごとにカード形式で区切られて表示

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者様を選択して詳細画面を開きます
3. 処方薬がカード形式で整理されて表示されます
4. 処方日も併せて確認できます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#233, yakureki-back#293, #301
- 改善内容:
  - 処方データAPIの統合
  - カード形式での視覚的区別
  - prescription_dateフィールドの追加
  - タイプ定義の機能別分割

</details>

### ドロワーメニューのデザイン刷新
患者選択メニューの見た目と使い勝手を改善しました。

- **改善前：** 選択中の患者が分かりにくい
- **改善後：** 選択中の患者名が太字で表示され、色も変化

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 左側の「患者メニュー」ボタンをクリックします
3. 薄い青系の背景で統一されたメニューが表示されます
4. 選択中の患者様が太字で強調表示されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#235
- デザイン改善:
  - 背景色: rgba(227, 242, 253, 0.95)
  - ブラー効果: blur(10px)
  - 選択状態: fontWeight 600
  - ホバーエフェクトの追加

</details>

## ✅ 不具合の修正

---

### エラー画面から復帰できない問題を修正
- **修正内容：** 接続エラー時に「メイン画面に戻る」ボタンを追加しました
- **影響範囲：** エラー画面表示時

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-front#241
- 原因: エラー状態がクリアされない
- 対策: localStorage/sessionStorageのクリア機能追加

</details>

### 文字起こしエラーの改善
- **修正内容：** 空の録音データによるエラーを防止しました
- **影響範囲：** 音声録音機能使用時

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-back#305
- 原因: 空の文字起こしテキストによるVertex AI APIエラー
- 対策: 入力検証の追加

</details>

### SOAP更新時のキー不一致問題
- **修正内容：** チャットでのSOAP更新時のデータ不整合を修正しました
- **影響範囲：** SOAP編集機能

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-back#303
- 原因: UpdateSOAPByChatのキー不一致
- 対策: データ構造の統一

</details>

## ⚡ 処理速度の向上

---

- AI応答速度が約30%向上しました
- 処方データの読み込み時間が短縮されました

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- **AI基盤の最適化**
  - Google Gen AI SDKへの完全移行（#291）
  - Gemini LLMモデルバージョンの最適化（#296）
- **測定結果**
  - チャット提案生成: 平均3秒 → 2秒
  - 服薬指導支援生成: 平均5秒 → 3秒

</details>

## 🏗️ システム基盤の更新

---

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

このセクションは技術者向けの情報です。

### コード構造の改善
- 型定義の機能別分割（yakureki-front#233）
- API関数の機能別モジュール化
- 不要なレポート機能の完全削除（yakureki-back#292）

### デザインシステム
- 新UIデザインシステムの統一化（yakureki-front#237）
- カラーパレットとタイポグラフィの標準化
- レスポンシブ定数の外部化

### セキュリティ
- DOMPurifyによるXSS対策強化
- 防御的プログラミングの適切な実装

</details>

## 🔄 アップデート方法

---

システムは自動的に更新されます。特別な操作は必要ありません。

## 💡 便利な使い方のヒント

---

- 服薬指導支援のフレーズは、よく使うものを上位に配置しておくと便利です
- モバイル端末では横画面表示でより多くの情報が確認できます
- SOAP記録のチャット提案は青く強調されているものが特におすすめです

## 📞 お問い合わせ

---

ご不明な点やお困りの際は、以下までお気軽にお問い合わせください：

- **電話：** [サポート電話番号]
- **メール：** support@medilab.jp
- **営業時間：** 平日 9:00-18:00

---

今後ともKakeruをよろしくお願いいたします。