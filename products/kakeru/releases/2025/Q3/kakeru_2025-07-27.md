# Kakeru v2.4.0 アップデートのお知らせ

いつもKakeruをご利用いただきありがとうございます。
2025年7月27日にリリースした最新版の内容をお知らせいたします。

## 📢 今回のアップデートについて
今回のアップデートで、患者様の管理機能が大幅に強化され、加算履歴の確認やデータエクスポート機能が追加されました。また、システムの安定性と処理速度が大幅に向上しています。

## 🆕 新しく追加された機能

### 患者管理システムの大幅強化
患者様ごとに重要な確認事項（チェックポイント）と必要な対応（アクション）を管理できる機能を追加しました。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者詳細画面を開きます
3. 「主要確認事項」セクションで重要事項を一覧確認できます
3. 「対応事項」セクションでアクションの完了/未完了を管理できます
4. チェックボックスで簡単に状態を切り替えられます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#339, #331, yakureki-front#288, #287
- 主な変更:
  - PatientCheckpoint/PatientActionモデルの実装
  - チェックポイント・アクション管理API
  - 来院履歴取得機能
  - Django Admin統合
- API最適化: N+1クエリ解決、ページネーション実装

</details>

### 加算履歴の表示機能
服薬指導に関連する加算の履歴を確認できる機能を追加しました。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者詳細画面を開きます
3. 「加算履歴」タブをクリックします
3. 過去の加算内容と日付が一覧表示されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#298, yakureki-back#353, #355
- 主な変更:
  - 加算履歴API実装
  - guidance_prepモジュールの追加
  - 加算履歴表示UIの実装

</details>

### データエクスポート機能
NSIPSデータをCSV形式でエクスポートできる機能を追加しました。

**お手元での確認方法：**
1. 「管理ポータルへ」ボタンをクリックします
2. 「NSIPSデータエクスポート」カードをクリックします
3. 期間を指定して「エクスポート」ボタンをクリックします
3. CSVファイルがダウンロードされます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#297, yakureki-back#348, #328, #320
- 主な変更:
  - NSIPSエクスポートAPI実装
  - CSVエクスポート機能の汎用化
  - セキュリティ強化（権限チェック追加）

</details>

### 薬品プレースホルダーの複数選択
SOAP記録で複数の薬品を一度に選択・置換できるようになりました。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. SOAP編集画面で【薬品名】のような記載をクリックします
2. 薬品選択ダイアログで複数の薬品にチェックを入れます
4. 「選択」ボタンで一括置換されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#268, #282
- 主な変更:
  - 複数選択UI実装
  - 【】で囲まれた全文字列に対応
  - プレースホルダーパターンの拡張

</details>

### フォローアップ準備フレーズタブ
患者フォローアップ画面に、事前に準備したフレーズを登録・利用できるタブを追加しました。

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 患者詳細画面から「フォローアップ」セクションを開きます
2. 「準備フレーズ」タブをクリックします
3. よく使うフレーズを登録・選択できます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#272, #273
- 主な変更:
  - PrepPhraseタブコンポーネント追加
  - フレーズ管理機能実装
  - 空状態メッセージの追加

</details>

## 📈 使いやすさの改善

### 患者情報表示の改善
- **改善前：** 患者の年齢・性別・医療機関名が分かりにくい
- **改善後：** 薬歴詳細画面で全ての情報が一目で確認可能

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 薬歴詳細画面を開きます
2. 画面上部に患者様の年齢・性別が表示されます
3. 医療機関名も併せて確認できます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-back#313, #343, yakureki-front#270
- 追加フィールド:
  - gender（性別）
  - age（年齢）
  - medical_institution_name（医療機関名）

</details>

### ポータル画面のデザイン改善
- **改善前：** ボタンが小さく押しにくい
- **改善後：** 大きなカード型ボタンで操作しやすく

**お手元での確認方法：**
1. ホーム画面を開きます
2. 各機能が大きなカードボタンで表示されます
3. アイコンと説明文で機能が分かりやすく表示されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#284, #293
- 改善内容:
  - ナビゲーションボタンの共通コンポーネント化
  - デザインシステム準拠
  - レスポンシブ対応強化

</details>

### 服薬指導準備中の表示改善
- **改善前：** 準備中の状態が分かりにくい
- **改善後：** アニメーションで処理中であることを明確に表示

**お手元での確認方法：**
1. 「患者メニュー」ボタンをクリックします
2. 服薬指導支援機能を開きます
2. データ生成中はアニメーションが表示されます
3. 完了すると自動的にコンテンツが表示されます

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 実装PR: yakureki-front#279
- 改善内容:
  - ローディングアニメーション追加
  - 処理状態の可視化

</details>

## ✅ 不具合の修正

### SOAP生成時の進行状態問題を修正
- **修正内容：** SOAP生成が完了しても「生成中」のまま止まる問題を修正
- **影響範囲：** SOAP自動生成機能

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-back#321, #311
- 原因: is_progressフラグのスタック問題
- 対策: エラーハンドリングの改善とフラグリセット処理

</details>

### 音声処理のクイックモード判定を修正
- **修正内容：** 音声録音の処理モードが正しく判定されない問題を修正
- **影響範囲：** 音声録音からのSOAP生成

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-back#327
- 原因: クイックモード判定ロジックの不具合
- 対策: 判定条件の修正

</details>

### フレーズ選択状態のリセット問題を修正
- **修正内容：** タブ切り替え時に選択状態が消える問題を修正
- **影響範囲：** 服薬指導支援画面

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- 修正PR: yakureki-front#286
- 原因: タブ切り替え時の状態管理不備
- 対策: 選択状態の永続化処理追加

</details>

## ⚡ 処理速度の向上

### 患者検索の大幅な高速化
- 患者一覧の表示が従来より約50%高速化
- 検索・フィルタ機能の応答時間が大幅短縮

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- **パフォーマンス最適化**（yakureki-back#341）
  - N+1クエリ問題の解決
  - prefetch_related/select_related最適化
  - SQLアノテーションによる効率化
  - ページネーション実装（デフォルト50件）
- **測定結果**
  - 患者一覧取得: 3秒 → 1.5秒
  - 検索処理: 2秒 → 0.8秒

</details>

### RDS負荷軽減対策
- データベースへの負荷を約40%削減
- システム全体の安定性が向上

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

- **負荷軽減対策**（yakureki-back#309, yakureki-front#266）
  - ポーリング間隔を2秒に変更
  - Gemini 2.5 Flashモデルへの一時切替（#307）
  - インデックス最適化
- **コード構造改善**（yakureki-back#329）
  - Djangoアプリ構造の大規模リファクタリング
  - モジュール分割による保守性向上

</details>

## 🏗️ システム基盤の更新

<details>
<summary>🔧 技術詳細（クリックで展開）</summary>

このセクションは技術者向けの情報です。

### アーキテクチャ改善
- Djangoアプリ構造の大規模整理（#329）
- Patient移行完了（#325）
- viewsモジュールの分割と整理（#335, #337）

### デプロイメント改善
- AWS自動デプロイにクリーンアップ処理追加（#337）
- インポートエラーの自動修正機能（#333, #335）

### セキュリティ強化
- ExportCSVAPIViewのセキュリティ強化（#320）
- SOAPキー定数定義によるタイプミス防止（#316）

### ドキュメント整備
- ADR-0019に残存ファイル検出・監視手法追加（#340）
- RDS ANALYZE実行手順書追加（#308）

</details>

## 🔄 アップデート方法

システムは自動的に更新されます。特別な操作は必要ありません。

## ⚠️ ご注意事項

- 患者管理機能の一部は権限設定により表示されない場合があります
- CSVエクスポート機能は管理者権限が必要です

## 💡 便利な使い方のヒント

- 患者管理のチェックポイントは、重要な確認事項をまとめて管理するのに便利です
- 加算履歴は月次レポート作成時の参考資料として活用できます
- 薬品の複数選択機能で、処方変更の入力が大幅に短縮できます

## 📞 お問い合わせ

ご不明な点やお困りの際は、以下までお気軽にお問い合わせください：

- **電話：** [サポート電話番号]
- **メール：** support@medilab.jp
- **営業時間：** 平日 9:00-18:00

---

今後ともKakeruをよろしくお願いいたします。